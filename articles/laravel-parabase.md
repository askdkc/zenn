---
title: "Laravel„Åã„ÇâSupabase„ÅßPGroonga„Çí‰Ωø„ÅÜ"
emoji: "üêò"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ['laravel','php','postgresql','ÂÖ®ÊñáÊ§úÁ¥¢','pgroonga']
published: true
---

# Supabase„ÇíLaravel„Åã„Çâ‰Ωø„ÅÜÊñπÊ≥ï

D„Åï„ÇìÔºö„Äå„ÅÑ„ÇÑ„Äú„ÄÅLaravel„Åß„Ç¢„Éó„É™„ÇíÈñãÁô∫„Åô„ÇãÊñπÊ≥ï„ÅØËâ≤„ÄÖ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„ÇÑ„Å£„Å±„Çä‰∏ÄÁï™ËààÂ•Æ„Åô„Çã„ÅÆ„ÅØ„Éû„Éç„Éº„Ç∏„Éâ„Å™DB„ÅßÈ´òÈÄüÊó•Êú¨Ë™ûÂÖ®ÊñáÊ§úÁ¥¢„ÅÆ`PGroonga`„Çí‰Ωø„Åà„ÅüÊôÇ„Åß„Åô„Å≠ÔºÅ„Äç

T„Åï„ÇìÔºö„ÄéÈñìÈÅï„ÅÑ„Å™„ÅÑ„Å≠ÔºÅ„Äè

## „Çµ„Ç§„É≥„Ç¢„ÉÉ„Éó
„Åæ„Åö„ÅØ[supabase](https://supabase.com)„Å´„Çµ„Ç§„É≥„Ç¢„ÉÉ„Éó„Åó„Å¶„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰ΩúÊàê„Åó„ÄÅÈÅ©ÂΩì„Å´ÁµÑÁπî„Çí‰Ωú„Çä„ÄÅ‰∏ãË®ò„ÅÆ„Çà„ÅÜ„Å™„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Åæ„Åô

![](https://storage.googleapis.com/zenn-user-upload/d1cc3425a4ae-20230805.png)

‰∏äÂõ≥„ÅÆ„Çà„ÅÜ„Å´ **Project Settings > Database > Database Setting** „ÅÆÁÆáÊâÄ„Å´Laravel„Åã„ÇâDB„Å´Êé•Á∂ö„Åô„ÇãÈöõ„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„ÅåÊõ∏„Åã„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„Åì„Çå„Çí‰Ωø„ÅÑ„Åæ„Åô

(„Åì„Çå„ÅØ„ÅÇ„Åè„Åæ„Åß„Çµ„É≥„Éó„É´„Å™„ÅÆ„Åß„ÄÅÊó¢„Å´„Åì„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅØÊ∂à„Åó„Å¶„ÅÇ„Çä„Åæ„Åô)

## Laravel„ÅÆ`.env`„Å∏„ÅÆDBË®≠ÂÆö

Ëá™ÂàÜ„ÅÆLaravel„ÅÆ`.env`„Éï„Ç°„Ç§„É´„Å´„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Åß„É°„É¢„Åó„ÅüË®≠ÂÆöÂÄ§„Çí‰∏ãË®ò„ÅÆ„Çà„ÅÜ„Å´ÂÖ•„Çå„Å¶Ë°å„Åç„Åæ„ÅôÔºà„Åù„Çå„Åû„Çå„ÅÆÁÆáÊâÄ„ÅØËá™ÂàÜ„ÅÆÂÄ§„Å´Áõ¥„Åó„Å¶„Å≠Ôºâ
```vim
DB_CONNECTION=pgsql
DB_HOST=db.phimnigkzjblpukeobou.supabase.co
DB_PORT=5432
DB_DATABASE=postgres
DB_USERNAME=postgres
DB_PASSWORD=Ëá™ÂàÜ„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ
```

## PGroonga„Çí‰Ωø„Å£„Å¶„ÅÑ„Åè„ÅûÔºÅ

„ÅÑ„ÅèüêòÔºÅ

## Extension„ÇíON„Å´„Åô„Çã
Supabase„ÅØÊó•Êú¨Ë™ûÊ§úÁ¥¢„Å´Âº∑„ÅÑ`PGroonga`„Çí‰Ωø„Åà„ÇãÂîØ‰∏Ä„ÅÆ„Éû„Éç„Éº„Ç∏„Éâ„Å™DB„Å™„ÅÆ„Åß„ÄÅ‰Ωø„ÅÑ„Åæ„ÅôÔºÅ

Â∑¶ÂÅ¥„ÅÆ**Database**„ÅÆ**Extension**„ÇíÈñã„ÅÑ„Å¶Ê§úÁ¥¢„Éï„Ç£„Éº„É´„Éâ„Å´`PGroonga`„Å®ÂÖ•„Çå„Çã„Å®Âá∫„Å¶„Åç„Åæ„ÅôÔºàÂ∑¶ÂÅ¥„ÅÆPGroonga„ÇíÈÅ∏Êäû„Åó„Å¶„Å≠Ôºâ

![](https://storage.googleapis.com/zenn-user-upload/a36191a5355d-20230805.png)

## Schema„ÅØpublic„ÇíÈÅ∏Êäû

„Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´„ÅØÂü∫Êú¨`public`„Çπ„Ç≠„Éº„Éû„Å´‰Ωú„Çâ„Çå„Çã„ÅÆ„Åß„ÄÅ`public`„Å´Extension„ÇíON„Å´„Åó„Å¶„Åä„Åç„Åæ„Åô

![](https://storage.googleapis.com/zenn-user-upload/6d07bcea2ac4-20230805.png)

## LaravelÂÅ¥„Åß„ÉÜ„Éº„Éñ„É´‰ΩúÊàê„ÇÑ„ÉÄ„Éü„Éº„Éá„Éº„Çø‰ΩúÊàê

### ÈõõÂΩ¢(Laravel Breeze)Ê∫ñÂÇô
ÁîªÈù¢ÁîüÊàê„Åå„Åó„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßLaravel Breeze„Å®„Åù„ÅÆÊó•Êú¨Ë™ûÂåñ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÇíÂÖ•„Çå„Å¶„Åä„Åç„Åæ„Åô

```bash
composer require laravel/breeze --dev
composer require askdkc/breezejp --dev

php artisan breeze:install blade
php artisan breezejp
```
„Åì„Çå„ÅßLaravel Breeze„Å®Êó•Êú¨Ë™ûÂåñ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüüëçüáØüáµ(Breezejp„ÅØ‰æøÂà©„Å™„ÅÆ„ÅßGithub„ÅÆ„É™„Éù„Ç∏„Éà„É™„Å´„Çπ„Çø„Éº„Åó„Å¶„ÅÇ„Åí„Åæ„Åó„Çá„ÅÜüíù)

### migration„Å®factory„ÅÆ‰ΩúÊàê

„Çµ„É≥„Éó„É´„Å®„Åó„Å¶„Éñ„É≠„Ç∞Ë®ò‰∫ãÔºàPostÔºâ„É¢„Éá„É´„Çí‰Ωú„Å£„Å¶Ë°å„Åç„Åæ„Åô
```bash
php artisan make:model -mf Post
```

- `database/migrations/yyyy_mm_dd_ssssss_create_posts_table.php`
 
```php
public function up(): void
{
    Schema::create('posts', function (Blueprint $table) {
        $table->id();
        $table->text('title');
        $table->text('body')->nullable();
        $table->timestamps();
    });
}
```

- `database/factories/PostFactory.php`
 
```php
public function definition(): array
{
    return [
        'title' => $this->faker->realText(20),
        'body' => $this->faker->realText(200),
    ];
}
```

- `database/seeders/DatabaseSeeder.php`

```php
public function run(): void
{
    for ($i = 0; $i < 100; $i++) {
        \App\Models\Post::factory(100)->create();
    }
}
```

## migrate„Å®ÂêåÊôÇ„Å´„ÉÄ„Éü„Éº„Éá„Éº„ÇøÊîæ„ÇäËæº„Åø
```bash
php artisan migrate --seed
```

10,000‰ª∂„ÅÆ„ÉÄ„Éü„Éº„Éá„Éº„Çø„Çí**Supabase**ÂÅ¥„Å´‰Ωú„Çã„ÅÆ„Å´„ÅØ10ÂàÜÁ®ãÂ∫¶„Åã„Åã„Çã„ÅÆ„Åß„Ç≥„Éº„Éí„Éº„Åß„ÇÇÈ£≤„Çì„ÅßÂæÖ„Å°„Åæ„Åô‚òïÔ∏è

„Å™„Åä„ÄÅÈÄî‰∏≠ÁµåÈÅé„ÅØSupabase„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆ**Table editor > posts**„Åã„ÇâÁ¢∫Ë™çÂèØËÉΩ„Åß„Åô

![](https://storage.googleapis.com/zenn-user-upload/611c4d1cc746-20230805.png)

## PGroongaÁî®„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ‰ΩúÊàêÔºàÈáçË¶ÅÔºâ
`PGroonga`„Çí‰Ωø„ÅÜ‰∏ä„Åß„ÅÆÊúÄÈáçË¶ÅÈ†ÖÁõÆÔºö„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Çí‰ΩúÊàê„Åó„Åæ„Åô

**SQL Editor > +New query**„Åó„Å¶„ÄÅ‰∏ãË®ò„ÇíÂÆüË°å„Åó„Åæ„Åô

```sql
CREATE INDEX pg_title_index ON posts USING pgroonga (title);
CREATE INDEX pg_body_index ON posts USING pgroonga (body);
```
![](https://storage.googleapis.com/zenn-user-upload/74885b42e22f-20230805.png)

## LaravelÂÅ¥„ÅßÊ§úÁ¥¢„Åó„Å¶„Åø„Çã„Åûüîç

## Ê§úÁ¥¢Áî®„Ç≥„É≥„Éà„É≠„Éº„É©„ÇÑ„Éì„É•„Éº‰ΩúÊàê

### Post„É¢„Éá„É´„Å´Ê§úÁ¥¢Ê©üËÉΩ‰ªò‰∏é

- `app/Models/Post.php`

```php
class Post extends Model
{
    use HasFactory;

    public static function search($keyword)
    {
        if(empty($keyword)){
            return static::query();
        }

        $search_columns = ['title', 'body'];

        $search_query = static::query();

        foreach($search_columns as $column){
            $search_query->orWhereRaw("$column &@~ ?", [$keyword]);
        }

        return $search_query;
    }
}
```

### Ê§úÁ¥¢Áî®„Ç≥„É≥„Éà„É≠„Éº„É©‰ΩúÊàê

```bash
php artisan make:controller SearchController
```

- `app/Http/Controllers/SearchController.php`

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\View\View;

class SearchController extends Controller
{
    public function index() : View
    {
        $posts = \App\Models\Post::query()->paginate(10);

        return view('posts.index', compact('posts'));
    }

    public function search(Request $request) : View
    {
        $keyword = $request->input('keyword');

        $posts = \App\Models\Post::search($keyword)->paginate(10)->withQueryString();

        return view('posts.index', compact('posts', 'keyword'));
    }

}
```

### Ê§úÁ¥¢Áî®„Éì„É•„Éº‰ΩúÊàê

- `resources/views/layouts/guest.blade.php`

Ê§úÁ¥¢ÁîªÈù¢„Å´‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´Â∞ë„ÅóÂπÖ„ÇíÊã°Â§ß
 
**Before**
```html
<!-- Line 25 -->
	<div class="w-full sm:max-w-md mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg">
		{{ $slot }}
	</div>
```

**After**
```html
<!-- Line 25 -->
	<div class="w-full lg:max-w-6xl mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg">
	    {{ $slot }}
	</div>
```

### Ê§úÁ¥¢ÂÖº‰∏ÄË¶ßË°®Á§∫ÁîªÈù¢
- `resources/views/posts/index.blade.php`
 
```php
<x-guest-layout>
    <div class="py-2">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-2 bg-white border-b border-gray-200">

                    <div>
                        <div class="flex w-full justify-between items-center sm:mb-2">
                            <h2 class="text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:mb-4"><a href="/">Supabase Laravel</a> </h2>
                        </div>
                        <form action="{{ route('posts.search') }}" method="GET">
                            <div class="flex mb-4 justify-between items-center">
                                <div class="block w-3/4">
                                    <div class="flex flex-col sm:flex-row justify-start items-center pl-2">
                                    <input type="search" name="keyword" class="form-control w-full sm:w-5/6 " type="text" value="@if (isset($keyword)) {{ $keyword }} @endif" placeholder="{{ __('Enter search keyword') }}">
                                    <button class="collapse sm:visible inline-block align-left text-base sm:w-20 rounded-md border border-gray-700 sm:p-2 sm:ml-4" type="submit">{{ __('Search') }}</button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        @if($posts ?? false)
                        <div class="container">
                            <div class="bg-white">
                              <div class="max-w-2xl mx-auto px-4 grid items-center grid-cols-1 gap-y-16 gap-x-8 sm:px-6 lg:max-w-7xl lg:px-8 lg:grid-cols-1">
                                <div>

                                  <dl class="sm:mt-8 grid grid-cols-1 gap-x-6 gap-y-2 grid-cols-1 sm:grid-cols-7 sm:gap-y-2 lg:gap-x-8">
                                    <div class="border-t border-gray-200">
                                      <dt class="text-sm sm:text-base sm:font-medium text-gray-900">
                                              ID
                                      </dt>
                                    </div>

                                    <div class="border-t border-gray-200 sm:col-span-2">
                                      <dt class="text-sm sm:text-base sm:font-medium text-gray-900">
                                        {{ __('Title') }}
                                      </dt>
                                    </div>

                                    <div class="border-t border-gray-200 sm:col-span-4">
                                      <dt class="text-sm sm:text-base font-medium text-gray-900">
                                        {{ __('Body') }}
                                      </dt>
                                    </div>

                                    @foreach($posts as $post)
                                        <div class="border-t border-gray-200 pt-1">
                                            <dd class="sm:mt-2 text-sm text-gray-500">
                                                <span class="block m-1">ID: {{ $post->id }}</span>
                                            </dd>
                                        </div>

                                        <div class="border-t border-gray-200 pt-1 sm:col-span-2">
                                            <dd class="sm:mt-2 text-sm text-gray-500">
                                                <span class="block m-1">{{ $post->title }}</span>
                                            </dd>
                                        </div>

                                        <div class="border-t border-gray-200 pt-1 sm:col-span-4">
                                          <dd class="sm:mt-2 text-sm text-gray-500">
                                              <span class="block m-1 line-break">{{ $post->body }}</span>
                                          </dd>
                                        </div>

                                    @endforeach
                                  </dl>
                                </div>

                                  <div>
                                    {{ $posts->links() }}
                                  </div>

                              </div>
                            </div>
                        </div>
                        @endif

                    </div>

                </div>
            </div>
        </div>
    </div>
</x-guest-layout>
```

## RouteË®≠ÂÆö

- `routes/web.php`

```php
/* ÂÖÉ„ÄÖ„ÅÆTOP„Éö„Éº„Ç∏„ÅÆÁÆáÊâÄ„Çí„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà
Route::get('/', function () {
    return view('welcome');
});
*/

Route::get('/',  [\App\Http\Controllers\SearchController::class, 'index']) // ‰ª£„Çè„Çä„Å´ËøΩÂä†
    ->name('posts.index'); // ‰ª£„Çè„Çä„Å´ËøΩÂä†
Route::get('/search',  [\App\Http\Controllers\SearchController::class, 'search']) // ‰ª£„Çè„Çä„Å´ËøΩÂä†
    ->name('posts.search'); // ‰ª£„Çè„Çä„Å´ËøΩÂä†

(ÊÆã„Çä„ÅØÁúÅÁï•)
```

## Âãï‰ΩúÁ¢∫Ë™ç

ÂøÖË¶Å„Å™CSS„Å®„Åã„Éì„É´„Éâ„Åó„Å¶Ëµ∑Âãï
```bash
npm run build
php artisan serve
```

http://127.0.0.1:8000 „Å∏„Ç¢„ÇØ„Çª„Çπ

„Äå„Ç´„É†„Éë„Éç„É´„É©„Äç„ÅßÊ§úÁ¥¢„Åó„Å¶„Åø„Åæ„Åô

![](https://storage.googleapis.com/zenn-user-upload/69c4901ecd3d-20230805.png)

## PGroonga„ÄÅ„Åù„Çå„ÅØ‰æøÂà©Ê§úÁ¥¢
- ANDÊ§úÁ¥¢

Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„Çπ„Éö„Éº„Çπ„ÅßÂå∫Âàá„Çå„Å∞ANDÊ§úÁ¥¢„Å†ÔºÅ‰æøÂà©ÔºÅ

‰æãÔºö„Ç∏„Éß„Éê„É≥„Éã „Ç´„É†„Éë„Éç„É´„É© ‚Üí ‰∏°Êñπ„ÇíÂê´„ÇÄ„Éá„Éº„Çø„ÇíÊ§úÁ¥¢

- NOTÊ§úÁ¥¢

Âê´„Çì„ÅßÊ¨≤„Åó„Åè„Å™„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„Åå„ÅÇ„Å£„Åü„Çâ`-`„Çí‰ªò„Åë„Çã„ÅÆ„Åß„ÅôÔºÅ

‰æãÔºö„Ç∏„Éß„Éê„É≥„Éã -„Ç´„É†„Éë„Éç„É´„É© ‚Üí „Ç∏„Éß„Éê„É≥„Éã„ÇíÂê´„Åø„ÄÅ„Åã„Å§„Ç´„É†„Éë„Éç„É´„É©„ÅåÂê´„Åæ„Çå„Å™„ÅÑ„Éá„Éº„Çø„ÇíÊ§úÁ¥¢

- ORÊ§úÁ¥¢

„Å®„Å´„Åã„ÅèËâ≤„ÄÖ„Éí„ÉÉ„Éà„Åï„Åõ„Åü„ÅÑ„ÅÇ„Å™„Åü„Å´ÔºÅÈñì„Å´OR„Çí‰ªò„Åë„Çã„ÅÆ„Åß„ÅôÔºÅ

‰æãÔºö„Ç∏„Éß„Éê„É≥„Éã OR „Ç´„É†„Éë„Éç„É´„É© ‚Üí „Ç∏„Éß„Éê„É≥„Éã„ÇÇ„Åó„Åè„ÅØ„Ç´„É†„Éë„Éç„É´„É©„ÅåÂê´„Åæ„Çå„Å¶„Çå„Å∞„Éí„ÉÉ„ÉàÔºÅ


## „É°„Éã„É•„Éº„ÅÆÊó•Êú¨Ë™ûÂåñ

Breeejp„Å´„Çà„Å£„Å¶ÊÆÜ„Å©„ÅØÊó•Êú¨Ë™ûÂåñ„Åï„Çå„Å¶„Çã„ÅÆ„Åß„Åô„Åå„ÄÅÊ§úÁ¥¢ÁîªÈù¢Áî®„ÅÆÂÄ§„ÅåÁÑ°„ÅÑ„ÅÆ„Åß„ÄÅ‰∏ãË®ò„Çí`lang/ja.json`„Å´ËøΩÂä†„Åó„Åæ„Åô

```json
(„Å©„Åì„Åã„ÅÆ‰∏≠Èñì„Å´ÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ)

    "Title": "„Çø„Ç§„Éà„É´",
    "Body": "Êú¨Êñá",
    "Search": "Ê§úÁ¥¢",
    "Enter search keyword": "Ê§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ",

```

## PGroonga„ÅÆÂãï‰ΩúÁ¢∫Ë™ç(„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÂà©Áî®)
![](https://storage.googleapis.com/zenn-user-upload/5a1b09fff0a3-20230805.png)

## „Å°„Å™„Åø„Å´ 10,000‰ª∂Á®ãÂ∫¶„Åß„ÇÇÁµêÊßãÂÆπÈáèÈ£ü„ÅÑüòÖ
![](https://storage.googleapis.com/zenn-user-upload/a2a6385bc915-20230805.png)
